<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kri-shak - Scan Crop</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #126731;
      --primary-dark: #16a34a;
      --secondary: #3f83f8;
      --accent: #9061f9;
      --warning: #f05252;
    }

    .sidebar {
      width: 250px;
      transition: all 0.3s ease;
      background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
      }
      .sidebar .menu-text {
        display: none;
      }
      .main-content {
        margin-left: 70px;
      }
    }

    .upload-area {
      border: 2px dashed #d1d5db;
      transition: all 0.3s ease;
    }

    .upload-area:hover, .upload-area.dragover {
      border-color: var(--primary);
      background-color: #f0fdf4;
    }

    .camera-feed {
      background-color: #f3f4f6;
      border-radius: 12px;
      overflow: hidden;
    }

    .analysis-card {
      transition: all 0.3s ease;
      border-radius: 12px;
      overflow: hidden;
      background: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid #e5e7eb;
    }

    .notification-dot {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 12px;
      height: 12px;
      background-color: var(--warning);
      border-radius: 50%;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(14, 159, 110, 0.4);
    }

    .infection-low { border-left: 4px solid #16a34a; }
    .infection-medium { border-left: 4px solid #F59E0B; }
    .infection-high { border-left: 4px solid #EF4444; }

    .center-upload {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 60vh;
    }
    
    /* Full screen camera overlay */
    .camera-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .camera-container {
      width: 100%;
      max-width: 800px;
      position: relative;
    }
    
    .camera-controls {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 16px;
    }
    
    .camera-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
    }
    
    .capture-btn {
      background: var(--primary);
      color: white;
    }
    
    .close-btn {
      background: #f05252;
      color: white;
    }
    
    .flip-btn {
      background: rgba(255, 255, 255, 0.3);
      color: white;
    }
  </style>
</head>
<body class="bg-gray-50 flex">

  <div class="sidebar text-white h-screen fixed top-0 left-0 py-6 flex flex-col justify-between">
    <div>
      <div class="flex items-center justify-center px-4 py-2 mb-8">
        <i class="fas fa-leaf text-6xl"></i>
        <span class="menu-text ml-2 text-xl font-bold">Kri-shak</span>
      </div>

      <nav class="mt-10">
        <a href="dashboard.html" class="flex items-center px-6 py-3 text-gray-100 hover:bg-green-700 hover:bg-opacity-20 hover:text-white">
          <i class="fas fa-chart-pie"></i>
          <span class="menu-text ml-4">Dashboard</span>
        </a>
        <a href="my_farm.html" class="flex items-center px-6 py-3 mt-2 text-gray-100 hover:bg-green-700 hover:bg-opacity-20 hover:text-white">
          <i class="fas fa-map-marked-alt"></i>
          <span class="menu-text ml-4">My Farms</span>
        </a>
        <a href="scan_crop.html" class="flex items-center px-6 py-3 mt-2 text-white bg-green-700 bg-opacity-20">
          <i class="fas fa-camera"></i>
          <span class="menu-text ml-4">Scan Crop</span>
        </a>
        <a href="crop_recomendation.html" class="flex items-center px-6 py-3 mt-2 text-gray-100 hover:bg-green-700 hover:bg-opacity-20 hover:text-white">
          <i class="fas fa-seedling"></i>
          <span class="menu-text ml-4">Crop Advice</span>
        </a>
        <a href="help.html" class="flex items-center px-6 py-3 mt-2 text-gray-100 hover:bg-green-700 hover:bg-opacity-20 hover:text-white">
          <i class="fas fa-question-circle"></i>
          <span class="menu-text ml-4">Help & Support</span>
        </a>
      </nav>
    </div>
    
    <div class="px-6 py-4">
      <div class="flex items-center">
        <div class="relative">
          <img class="h-10 w-10 rounded-full object-cover" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'%3E%3Cpath fill-rule='evenodd' d='M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z' clip-rule='evenodd' /%3E%3C/svg%3E" alt="User">
          <div class="notification-dot"></div>
        </div>
        <div class="menu-text ml-3">
          <p class="text-sm font-medium" id="userEmail">Punjab Farmer</p>
          <p class="text-xs text-gray-200 cursor-pointer" onclick="logout()">Logout</p>
        </div>
      </div>
    </div>
  </div>

  <div class="main-content flex-1 ml-0 md:ml-[250px] p-6">
    <div class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-100">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div>
          <h2 class="text-2xl font-bold text-gray-800">Crop Health Scanner</h2>
          <p class="text-gray-600">Upload or capture images of your crops for disease detection</p>
        </div>
        <div class="mt-4 md:mt-0">
          <a href="dashboard.html" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg flex items-center cursor-pointer hover:bg-gray-200 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            <span>Back to Dashboard</span>
          </a>
        </div>
      </div>
    </div>

    <div class="center-upload">
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8 w-full max-w-2xl">
        <h3 class="text-xl font-semibold mb-6 text-center">Upload Crop Image</h3>
        <div class="upload-area rounded-lg p-12 text-center mb-6" id="dropZone">
          <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"></i>
          <p class="text-gray-600 mb-2 text-lg">Drag & drop your image here</p>
          <p class="text-gray-500 text-sm mb-4">or</p>
          <label for="fileUpload" class="btn-primary text-white px-8 py-3 rounded-lg cursor-pointer inline-block text-lg">
            <i class="fas fa-upload mr-2"></i>Browse Files
          </label>
          <input type="file" id="fileUpload" accept="image/*" class="hidden">
          <p class="text-gray-500 text-xs mt-4">Supported formats: JPG, PNG, JPEG</p>
        </div>
        <div class="text-center">
          <p class="text-gray-600 mb-4">or</p>
          <button class="btn-primary text-white px-8 py-3 rounded-lg w-full text-lg" onclick="openCameraFullScreen()">
            <i class="fas fa-camera mr-2"></i>Use Camera
          </button>
        </div>
      </div>
    </div>

    <div class="camera-overlay" id="cameraOverlay">
      <div class="camera-container">
        <video id="cameraStream" autoplay playsinline class="w-full h-auto rounded-lg"></video>
        <div class="camera-controls">
          <button class="camera-btn flip-btn" onclick="flipCamera()">
            <i class="fas fa-sync-alt"></i>
          </button>
          <button class="camera-btn capture-btn" onclick="captureImage()">
            <i class="fas fa-camera"></i>
          </button>
          <button class="camera-btn close-btn" onclick="closeCamera()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>
    <canvas id="capturedImage" class="hidden"></canvas>
  </div>

  <script>
    let currentStream;
    let currentFacingMode = 'environment'; // 'user' for front camera, 'environment' for back camera

    async function openCameraFullScreen() {
      const cameraOverlay = document.getElementById('cameraOverlay');
      const cameraStream = document.getElementById('cameraStream');
      cameraOverlay.style.display = 'flex';

      try {
        const constraints = {
          video: {
            facingMode: currentFacingMode
          }
        };
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        cameraStream.srcObject = currentStream;
      } catch (err) {
        console.error("Error accessing the camera: ", err);
        alert("Unable to access the camera. Please check your device permissions.");
        closeCamera();
      }
    }

    function closeCamera() {
      const cameraOverlay = document.getElementById('cameraOverlay');
      if (currentStream) {
        const tracks = currentStream.getTracks();
        tracks.forEach(track => track.stop());
      }
      cameraOverlay.style.display = 'none';
    }

    function captureImage() {
      const cameraStream = document.getElementById('cameraStream');
      const capturedImageCanvas = document.getElementById('capturedImage');
      const context = capturedImageCanvas.getContext('2d');
      
      capturedImageCanvas.width = cameraStream.videoWidth;
      capturedImageCanvas.height = cameraStream.videoHeight;
      
      context.drawImage(cameraStream, 0, 0, capturedImageCanvas.width, capturedImageCanvas.height);
      
      const imageDataURL = capturedImageCanvas.toDataURL('image/jpeg');
      console.log('Image captured:', imageDataURL.substring(0, 50) + '...');
      
      alert('Image captured! Ready for analysis.');
      closeCamera();
    }
    
    async function flipCamera() {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }

      currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';

      await openCameraFullScreen();
    }
    
    function logout() {
      console.log("User logged out");
      window.location.href = "login.html";
    }
  </script>
</body>
</html>